<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Felices 9 meses coraz√≥n</title>
  <style>
    :root{
      --bg:#0b1220;
      --accent:#ff4d6d; /* coraz√≥n */
      --accent-dark:#e73b5a;
      --paper:#fff8f8;
      --envelope:#f0e4d7;
      --envelope-shadow:#e6d7c4;
      --ink:#2a2a2a;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background: radial-gradient(1200px 600px at 50% -20%, #1a2440 0%, #0b1220 60%, #070b14 100%);
      color:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      overflow:hidden; /* para que la nieve no agregue scroll */
    }

    /* Lienzo de nieve */
    #snow{position:fixed;inset:0;z-index:0;pointer-events:none}

    /* Contenedor central */
    .stage{
      position:relative; z-index:1; height:100%; width:100%;
      display:grid; place-items:center;
      padding:24px;
    }
    .card-scene{ position:relative; width:min(560px, 92vw); aspect-ratio:16/12; }

    /* Mensaje de instrucciones */
    .hint{position:absolute; bottom:-40px; left:50%; transform:translateX(-50%);
      font-size:14px; opacity:.8; text-align:center; white-space:nowrap}

    /* ENVELOPE (SVG) WRAPPER */
    .envelope-wrap{
      position:absolute; inset:0; display:grid; place-items:center;
      perspective:1200px; /* para sensaci√≥n de profundidad del flap */
    }
    svg.envelope{ width:90%; max-width:520px; filter: drop-shadow(0 10px 24px rgba(0,0,0,.35)); }

    /* Flap animable */
    #flap{ transform-origin:50% 20%; transition: transform 900ms cubic-bezier(.2,.8,.2,1); }
    /* Coraz√≥n sello (bot√≥n) */
    .heart-btn{
      position:absolute; width:70px; aspect-ratio:1/1; border:none; border-radius:50%;
      left:50%; top:44%; transform:translate(-50%, -50%);
      background: radial-gradient(circle at 30% 30%, #ffd0d8 0 18px, var(--accent) 18px);
      cursor:pointer; box-shadow:0 6px 12px rgba(0,0,0,.25), inset 0 -6px 10px rgba(0,0,0,.15);
      display:grid; place-items:center; transition:transform .15s ease; outline: none;
    }
    .heart-btn:active{ transform:translate(-50%, -50%) scale(.96) }
    .heart-shape{ width:60%; height:60%; position:relative; transform:rotate(-45deg); }
    .heart-shape::before, .heart-shape::after{
      content:""; position:absolute; width:100%; height:100%; background:var(--accent);
      border-radius:50%;
    }
    .heart-shape::before{ left:50%; }
    .heart-shape::after{ top:-50%; }
    .heart-btn.pulse{ animation:pulse 420ms ease; }
    @keyframes pulse{ 0%{transform:translate(-50%, -50%) scale(1)} 50%{transform:translate(-50%, -50%) scale(1.12)} 100%{transform:translate(-50%, -50%) scale(1)} }

    /* Contador de clics */
    .counter{
      position:absolute; top:6px; right:6px; background:rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px;
      backdrop-filter: blur(4px);
    }

    /* CARTA EN FORMA DE CORAZ√ìN (sale del sobre) */
    .letter-wrap{
      position:absolute; left:50%; top:52%; transform:translate(-50%, -10%);
      width:min(420px, 80%); pointer-events:auto; transition: transform 900ms cubic-bezier(.2,.8,.2,1), opacity 900ms; opacity:0;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.35));
    }
    .heart-letter{
      position:relative; width:100%; aspect-ratio:1/1; transform:rotate(-2deg);
      display:grid; place-items:center;
    }
    /* Dibujamos el coraz√≥n con pseudo-elementos */
    .heart-letter::before{
      content:""; position:absolute; inset:0; transform:rotate(-45deg) scale(1.05);
      background:var(--paper); border-radius:12% 12% 0 0 / 18% 18% 0 0;
      box-shadow: inset 0 0 0 3px #ffe2e7, inset 0 0 0 6px #ffd6de; /* borde suave */
    }
    .heart-letter::after{
      content:""; position:absolute; inset:0; transform:rotate(-45deg) scale(1.05);
      background:var(--paper);
      /* recortar para formar el coraz√≥n: usamos m√°scara con radial-gradients */
      -webkit-mask: 
        radial-gradient(60% 60% at 25% 35%, #000 98%, transparent 99%) top left / 50% 50% no-repeat,
        radial-gradient(60% 60% at 75% 35%, #000 98%, transparent 99%) top right / 50% 50% no-repeat,
        linear-gradient(#000 0 0) bottom / 100% 60% no-repeat;
      mask: 
        radial-gradient(60% 60% at 25% 35%, #000 98%, transparent 99%) top left / 50% 50% no-repeat,
        radial-gradient(60% 60% at 75% 35%, #000 98%, transparent 99%) top right / 50% 50% no-repeat,
        linear-gradient(#000 0 0) bottom / 100% 60% no-repeat;
    }
    .message{
      position:relative; width:78%; height:72%; overflow:auto; padding:18px 18px 22px 18px;
      background:transparent; color:var(--ink); z-index:1;
      border-radius:16px; text-align:center; line-height:1.35; font-size: clamp(14px, 2.3vw, 18px);
      user-select:text; -webkit-user-select:text;
    }
    .message[contenteditable="true"]:empty:before{content: "Escribe aqu√≠ tu carta‚Ä¶"; color:#666}

    /* Estado "abierto" */
    .open #flap{ transform: rotateX(160deg) rotate(-180deg); }
    .open .heart-btn{ opacity:0; pointer-events:none; transition:opacity .3s ease .25s }
    .open .letter-wrap{ transform:translate(-50%, -64%) rotate(0deg); opacity:1; }

    /* Bot√≥n Reiniciar */
    .actions{ position:absolute; top:16px; left:16px; display:flex; gap:8px; z-index:2 }
    .btn{
      background:rgba(255,255,255,.1); color:#fff; border:1px solid rgba(255,255,255,.25);
      padding:8px 12px; border-radius:12px; cursor:pointer; backdrop-filter: blur(4px);
      font-size:14px; transition: background .2s ease, transform .12s ease;
    }
    .btn:hover{ background:rgba(255,255,255,.18) }
    .btn:active{ transform:scale(.98) }

    /* Peque√±as mejoras responsivas */
    @media (max-width:480px){
      .heart-btn{ width:62px }
      .hint{ font-size:12px; bottom:-36px }
    }
  </style>
</head>
<body>
  <canvas id="snow"></canvas>

  <div class="stage">
    <div class="actions">
      <button id="reset" class="btn" type="button">Reiniciar</button>
    </div>

    <div id="scene" class="card-scene">
      <div class="envelope-wrap">
        <!-- Contador -->
        <div class="counter" id="counter">T√≥calo 10 veces</div>

        <!-- Sobre (SVG) -->
        <svg class="envelope" viewBox="0 0 800 520" aria-label="Sobre con coraz√≥n">
          <!-- Cuerpo del sobre -->
          <rect x="60" y="120" width="680" height="320" rx="16" fill="var(--envelope)" />
          <!-- Sombras internas -->
          <rect x="60" y="120" width="680" height="320" rx="16" fill="url(#shade)" opacity="0.7" />

          <!-- Solapas inferiores en V -->
          <path d="M60 120 L400 380 L740 120 Z" fill="var(--envelope-shadow)"/>

          <!-- Flap superior (animable) -->
          <g id="flap">
            <path d="M60 120 L400 340 L740 120 Z" fill="var(--envelope)" />
            <path d="M60 120 L400 340 L740 120" fill="none" stroke="#e9dccc" stroke-width="6" opacity=".8" />
          </g>

          <defs>
            <linearGradient id="shade" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#000" stop-opacity="0.0"/>
              <stop offset="100%" stop-color="#000" stop-opacity="0.10"/>
            </linearGradient>
          </defs>
        </svg>

        <!-- Bot√≥n coraz√≥n (sello) -->
        <button id="heart" class="heart-btn" aria-label="Sello de coraz√≥n" title="T√≥calo 10 veces para abrir">
          <div class="heart-shape" aria-hidden="true"></div>
        </button>
      </div>

      <!-- Carta en forma de coraz√≥n -->
      <div class="letter-wrap" id="letterWrap" aria-live="polite">
        <div class="heart-letter">
          <div class="message" id="message" contenteditable="true" spellcheck="false">
Querida Valeria,
Solo para decirte lo agradecido que estoy por tener a alguien como tu en mi vida, lo cual me hace muy feliz
Gracias por todo tu apoyo y por quedarte en el proceso, quiero decirte de mi parte felices 9 meses juntos y 
para recordarte lo mucho que me gusta compartir esta parte de mi vida con tigo, gracias por darme el tiempo
y la paciencia con el respeto mutuo para aprender juntos, y asi seguir con una nueva etapa de nuestras vidas
Muchas Gracias por todo


Con cari√±o,
Dali
          </div>
        </div>
      </div>

      <div class="hint" id="hint">Consejo: tambi√©n puedes tocar r√°pido en el coraz√≥n üòâ</div>
    </div>
  </div>

  <script>
    // ======= Nieve en canvas =======
    (function(){
      const canvas = document.getElementById('snow');
      const ctx = canvas.getContext('2d');
      let w, h, flakes;
      function resize(){ w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; makeFlakes(); }
      function makeFlakes(){
        const count = Math.min(240, Math.floor(w*h/12000));
        flakes = Array.from({length:count}, ()=>({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*2.2+0.6,
          s: Math.random()*0.7+0.3, // velocidad vertical base
          a: Math.random()*Math.PI*2, // √°ngulo para vaiv√©n
          v: Math.random()*0.9+0.2 // velocidad horizontal
        }));
      }
      function draw(){
        ctx.clearRect(0,0,w,h);
        ctx.beginPath();
        for(const f of flakes){
          f.y += f.s; f.x += Math.cos(f.a+=0.01)*f.v*0.6;
          if(f.y > h+10){ f.y = -10; f.x = Math.random()*w; }
          if(f.x > w+10){ f.x = -10; }
          if(f.x < -10){ f.x = w+10; }
          ctx.moveTo(f.x, f.y);
          ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
        }
        ctx.fillStyle = 'rgba(255,255,255,.9)';
        ctx.fill();
        requestAnimationFrame(draw);
      }
      window.addEventListener('resize', resize);
      resize();
      draw();
    })();

    // ======= Interacci√≥n del sello (10 toques) =======
    const heart = document.getElementById('heart');
    const counter = document.getElementById('counter');
    const scene = document.getElementById('scene');
    const message = document.getElementById('message');
    const resetBtn = document.getElementById('reset');

    let taps = 0; const needed = 10; let opened = false;

    function updateCounter(){
      const remaining = Math.max(0, needed - taps);
      counter.textContent = opened ? 'Abierto ‚ô•' : (remaining>0? `T√≥calo ${remaining} ${remaining===1?'vez':'veces'}`: '¬°Listo!');
    }

    function openEnvelope(){
      if(opened) return; opened = true;
      scene.classList.add('open');
      updateCounter();
      // Enfocar para que puedas escribir al instante
      setTimeout(()=> message.focus(), 650);
    }

    function handleTap(){
      if(opened) return;
      taps++; heart.classList.remove('pulse');
      void heart.offsetWidth; // reinicia animaci√≥n
      heart.classList.add('pulse');
      if(taps >= needed){ openEnvelope(); }
      updateCounter();
    }

    heart.addEventListener('click', handleTap);
    heart.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); handleTap(); }});

    // Reset
    resetBtn.addEventListener('click', ()=>{
      opened = false; taps = 0; scene.classList.remove('open'); updateCounter();
      message.blur();
    });

    // Selecci√≥n f√°cil del texto de ejemplo al primer foco
    let firstFocus = true;
    message.addEventListener('focus', ()=>{
      if(firstFocus){
        firstFocus = false;
        const range = document.createRange();
        range.selectNodeContents(message);
        const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
      }
    });

    updateCounter();
  </script>
</body>
</html>
